(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{528:function(a,t,s){"use strict";s.r(t);var n=s(4),r=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("其实有"),s("a",{attrs:{href:"https://npm.taobao.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("淘宝npm镜像"),s("OutboundLink")],1),a._v("个人是完全无必要做npm的镜像的。\n一般的研发团队的宽带也无须考虑。但是我们是"),s("a",{attrs:{href:"http://club.autohome.com.cn/bbs/thread-a-100024-44338780-1.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("长城宽带"),s("OutboundLink")],1),a._v("。\n正好公司里有一台没啥事做的服务器，决定上手搞一个npm的镜像。")]),a._v(" "),s("h2",{attrs:{id:"原因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原因"}},[a._v("#")]),a._v(" 原因")]),a._v(" "),s("ol",[s("li",[a._v("npm安装的时间很长，同时依赖于公司带宽。")]),a._v(" "),s("li",[a._v("大规模/大量前端项目，可以把公用的模块独立成npm模块，单独管理。所以需要私有的npm仓储。")])]),a._v(" "),s("h2",{attrs:{id:"解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[a._v("#")]),a._v(" 解决方案")]),a._v(" "),s("p",[a._v("我们暂时不需要第二点，故使用"),s("a",{attrs:{href:"https://github.com/nolanlawson/local-npm",target:"_blank",rel:"noopener noreferrer"}},[a._v("local-npm"),s("OutboundLink")],1),a._v("解决npm加速问题就好了。")]),a._v(" "),s("blockquote",[s("p",[a._v("以后可以考虑换用"),s("a",{attrs:{href:"https://github.com/cnpm/cnpmjs.org",target:"_blank",rel:"noopener noreferrer"}},[a._v("cnpmjs"),s("OutboundLink")],1),a._v("来做私有仓储。")])]),a._v(" "),s("h3",{attrs:{id:"fullfatdb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fullfatdb"}},[a._v("#")]),a._v(" fullfatdb")]),a._v(" "),s("p",[a._v("fullfat就是全脂的意思，主要相对下面skim脱脂而言的。\n"),s("s",[a._v("我们使用淘宝的fullfatdb: https://registry.npm.taobao.org/")]),a._v("\n用的是官网的，因为local-npm对cnpmjs的镜像不兼容。给local-npm发了个"),s("a",{attrs:{href:"https://github.com/nolanlawson/local-npm/issues/123",target:"_blank",rel:"noopener noreferrer"}},[a._v("issue"),s("OutboundLink")],1),a._v("，暂时没空去贡献代码。")]),a._v(" "),s("blockquote",[s("p",[a._v("当前 registry.npm.taobao.org 是从 r.cnpmjs.org 进行全量同步的\nOur public registry: r.cnpmjs.org, syncing from registry.npmjs.org")])]),a._v(" "),s("h3",{attrs:{id:"skimdb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#skimdb"}},[a._v("#")]),a._v(" skimdb")]),a._v(" "),s("p",[s("a",{attrs:{href:"http://dict.youdao.com/w/skim",target:"_blank",rel:"noopener noreferrer"}},[a._v("skim"),s("OutboundLink")],1),a._v("是脱脂的意思。去掉了上面fullfatdb中二进制的部分，应该只是metadata部分，大概0.95GB大小。\n使用官方的 https://skimdb.npmjs.com/registry 进行克隆。因为暂时好像还没有国内镜像源。")]),a._v(" "),s("h2",{attrs:{id:"部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[a._v("#")]),a._v(" 部署")]),a._v(" "),s("p",[a._v("服务部署在本地开发服务器上。")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -g local-npm\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#local-npm -r https://registry.npm.taobao.org #不能使用-r taobao了，因为taobao是cnpmjs架设的，而-r只支持local-npm或者源站。")]),a._v("\nlocal-npm -u http://192.168.174.233:5080 "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#必须用上-u，否则会败，如果已经败了，在client上记得跑`npm cache clean`清理一下。")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h2",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[a._v("#")]),a._v(" 使用")]),a._v(" "),s("p",[a._v("不管用不用本地的npm服务源，都推荐用"),s("a",{attrs:{href:"https://github.com/Pana/nrm",target:"_blank",rel:"noopener noreferrer"}},[a._v("nrm"),s("OutboundLink")],1),a._v("进行npm源控制。就像不管你用不用多版本node，都推荐你使用"),s("a",{attrs:{href:"http://nvm.sh",target:"_blank",rel:"noopener noreferrer"}},[a._v("nvm"),s("OutboundLink")],1),a._v("一样。")]),a._v(" "),s("h3",{attrs:{id:"nrm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nrm"}},[a._v("#")]),a._v(" nrm")]),a._v(" "),s("p",[a._v("安装"),s("code",[a._v("npm install -g nrm")]),a._v("，使用很简单。\n可以有")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("nrm "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\nnrm use taobao\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("其实不用test直接use就好了。\n你可以直接输入"),s("code",[a._v("nrm")]),a._v("看看所有命令。\n其中有一个比较有趣的"),s("code",[a._v("nrm home taobao")]),a._v("。")]),a._v(" "),s("h3",{attrs:{id:"local-dev"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#local-dev"}},[a._v("#")]),a._v(" local-dev")]),a._v(" "),s("blockquote",[s("p",[a._v("[local-dev] 用 192.168.174.233 代替。 (公司内部服务器地址)")])]),a._v(" "),s("p",[a._v("使用nrm添加新源：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("nrm "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v(" http://"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("local-dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(":5080 http://"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("local-dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(":5080/_browse\nnrm use "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("就可以了。\n现在你可以"),s("code",[a._v("nrm test")]),a._v("看看谁延迟更低。")]),a._v(" "),s("h3",{attrs:{id:"search"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#search"}},[a._v("#")]),a._v(" search")]),a._v(" "),s("p",[a._v("对，如果你注意到了的话，http://[local-dev]:5080/_browse 是我们的一个npm搜索引擎。\n可以通过")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("nrm home "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("查看。")]),a._v(" "),s("h2",{attrs:{id:"注意"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[a._v("#")]),a._v(" 注意")]),a._v(" "),s("p",[a._v("由于只同步了0.95GB的metadata，二进制包并未同步。第一次下载模块时可能比平时慢（二进制包由server从官网下载，比淘宝要慢；当然查metadata还是块一些的）\n第二次就快了。")])])}),[],!1,null,null,null);t.default=r.exports}}]);